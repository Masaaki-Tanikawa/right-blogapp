-# 記事詳細ページの場合のみ"app/javascript/article.js"を読み込む (application.html.hamlの"yield :head"に挿入する)
- content_for :head do
  = javascript_import_module_tag "article"
-# 記事ID#article-showをHTMLのdata属性として埋め込む(JavaScriptから参照できるように)
.article#article-show{data: {article_id: @article.id}}
  - if @article.eyecatch.attached?
    .article_image
      = image_tag @article.eyecatch
  %h1.article_title= @article.title
  .article_detail
    -# 記事を作成したユーザーのアカウントページに遷移
    = link_to account_path(@article.user) do
      = image_tag @article.user.avatar_image # 記事を作成したユーザーのアバター画像を設定
    %div
      / ユーザー名にdisplay_name:メールアドレスの@以前を表示
      %p= @article.user.display_name
      %p= @article.display_created_at
      / 編集・削除ボタンをログイン時＋自分が書いた記事(記事のIDがログインしているユーザーのArticlesテーブルの中に存在する場合)のみ表示させる
      - if user_signed_in? && current_user.articles.exists?(id: @article.id)
        .article_detail_actions
          .dropdown
            = image_tag 'actions.svg', class: 'dropbtn'
            .dropdown-content.mini
              = link_to '編集する', edit_article_path(@article)
              = link_to '削除する', article_path(@article), data: { turbo_method: 'delete', turbo_confirm: '本当に削除してもよろしいですか？' }
  .article_content
    = @article.content
  - if user_signed_in? # ログインしている場合のみマークを表示・未ログインの場合はいいねできないため非表示
    -# Rubyの条件分岐を使わず、JavaScript側でhiddenクラスをトグル制御する
    .article_heart.hidden.active-heart
      -# ページ遷移せずにAjaxでいいね状態を切り替えるため、"link_to…"を削除
      = image_tag 'heart-active.svg'
    .article_heart.hidden.inactive-heart
      -# ページ遷移せずにAjaxでいいね状態を切り替えるため、"link_to…"を削除
      = image_tag 'heart.svg'

-# コメント一覧を表示
.article
  -# 「コメント一覧」を多言語表示する(config/locales/articles.XX.ymlを読み込み)
  %h2= I18n.t('articles.comment_list')
  -# Rubyではなく、JavaScriptで一覧を表示させる
  .comments-container

-# コメント投稿ボタンを実装
.container
  -# フォームを開く用の「コメントを追加」ボタンを実装(show-comment-formクラスでフォームの開閉)
  .btn-secondary.show-comment-form
    コメントを追加
  -# コメント入力フォームを実装(hiddenクラスでトグル開閉・初期値は空白('')・サイズをsmクラスで調整)
  .comment-text-area.hidden
    = text_area_tag :comment_content, '', class: 'sm'
    -# コメント送信用の「コメントを追加」ボタンを実装(add-comment-buttonクラスで入力内容の送信)
    .btn-secondary.add-comment-button
      コメントを追加